<html>

<head>
	<title>Huge Transactions Monitor</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
</head>
<body>
	<h1>APP</h1>
  	<div id="counter"></div>
	<div id="whaleText"></div>
	<section class="ftco-section">
		<div id="demo" class="container">
		</div>
	</section>
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.1/js/bootstrap.min.js"></script>

	<script>
	//$.get("http://34.75.110.94:8222/send")
	// trigger the route /send
	var eventSource1 = new EventSource("/listen");
	var eventSource2 = new EventSource("/whaleProducer");
	var speed = 15;
	var sizeLimit = 35;
	var i = 0;

	function typeWriter(txt, i) {
	var text = "" + txt;
		if (text.length !== undefined && i < text.length) {
			document.getElementById("demo").innerHTML += text.charAt(i);
			setTimeout(typeWriter, speed, text, i+1);
		}
	}

	function showText(txt) {
		if (i > sizeLimit) {
			document.getElementById("demo").innerHTML = '';
			i = 0;
		}
		document.getElementById("demo").innerHTML += txt;
		document.getElementById("demo").innerHTML += "<br>";
	i++;
	}

	var source = new EventSource("{{ url_for('sse.stream') }}");
	source.addEventListener('whaleAlert', function(event) {
		var data = JSON.parse(event.data);
		//typeWriter(data.text, 0)
		showText(data.text)
	}, false);
  
	eventSource.addEventListener("online", function(e) {
		data = JSON.parse(e.data)
		document.querySelector("#counter").innerText = data.counter
	  }, true)

	eventSource.addEventListener("whale", function(e) {
		data = JSON.parse(e.data)
		document.querySelector("#whaleText").innerText = data
	  }, true)
	</script>
</body>
</html>
