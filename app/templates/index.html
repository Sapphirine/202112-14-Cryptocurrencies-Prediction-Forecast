<html>

<head>
	<title>Huge Transactions Monitor</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
</head>
<body>
	<h2>Huge transactions alerts</h2>
	<section class="ftco-section">
		<div id="demo" class="container">
			<table>
				<tr>
					<td>Time &emsp;</td>
					<td>symbol &emsp;</td> 
					<td>price &emsp;</td>
					<td>usd &emsp;</td>
					<td>action &emsp;</td>
					<td>source &emsp;</td>
					<td>dest &emsp;</td>
				</tr>
			</table>
		</div>
	</section>
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.1/js/bootstrap.min.js"></script>

	<script>
	//$.get("http://34.75.110.94:8222/send")
	// trigger the route /send
	var eventSource = new EventSource("/whaleProducer");
	var speed = 15;
	var sizeLimit = 35;
	var i = 0;

	function typeWriter(txt, i) {
	var text = "" + txt;
		if (text.length !== undefined && i < text.length) {
			document.getElementById("demo").innerHTML += text.charAt(i);
			setTimeout(typeWriter, speed, text, i+1);
		}
	}

	function showText(txt) {
		if (i > sizeLimit) {
			document.getElementById("demo").innerHTML = '';
			i = 0;
		}
		document.getElementById("demo").innerHTML += txt;
		document.getElementById("demo").innerHTML += "<br>";
	i++;
	}

	var whaleDiv = document.getElementById('whaleText');

	eventSource.addEventListener("whale", function(e) {
		rows = JSON.parse(e.data);

		let unix_timestamp = parseInt(rows['timestamp'])
		var date = new Date(unix_timestamp * 1000);
		// Hours part from the timestamp
		var hours = date.getHours();
		// Minutes part from the timestamp
		var minutes = "0" + date.getMinutes();
		// Seconds part from the timestamp
		var seconds = "0" + date.getSeconds();

		// Will display time in 10:30:23 format
		var formattedTime = hours + ':' + minutes.substr(-2) + ':' + seconds.substr(-2);

		document.getElementById("demo").innerHTML += "<table><tr>"
		document.getElementById("demo").innerHTML += "<td>" + formattedTime + "&emsp;</td>";
		document.getElementById("demo").innerHTML += "<td>" + rows['symbol'] + "&emsp;</td>";
		document.getElementById("demo").innerHTML += "<td>" + rows['price'] + "&emsp;</td>";
		document.getElementById("demo").innerHTML += "<td>" + rows['usd'] + "&emsp;</td>";
		document.getElementById("demo").innerHTML += "<td>" + rows['action'] + "&emsp;</td>";
		document.getElementById("demo").innerHTML += "<td>" + rows['source'] + "&emsp;</td>";
		document.getElementById("demo").innerHTML += "<td>" + rows['dest'] + "&emsp;</td>";
		document.getElementById("demo").innerHTML += "</tr></table>"

	  }, true)
	</script>
</body>
</html>
